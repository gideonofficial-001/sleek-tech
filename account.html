<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Create Account | Sleek Tech</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="base.css">
  <link rel="stylesheet" href="account.css">
  <link rel="stylesheet" href="particles.css">

</head>

<body>
  <div id="particles"></div>

<div class="create-box card">
  <h2>Create Account</h2>

  <form id="form">
    <input type="text" id="username" placeholder="Username" required>
    <input type="email" id="email" placeholder="Email" required>

    <input type="password" id="password" placeholder="Password" required>
    <input type="password" id="confirmPassword" placeholder="Confirm Password" required>

    <label class="toggle">
      <input type="checkbox" id="showPassword"> Show password
    </label>

    <div class="strength">
      <div class="strength-bar">
        <div class="strength-fill" id="strengthFill"></div>
      </div>
      <small id="strengthText"></small>
    </div>

    <p id="error"></p>

    <button type="submit">Create Account</button>
  </form>
</div>

<!-- JS remains unchanged (your logic is correct) -->
<script type="module">
  import { auth, db } from "./firebase.js";
  import {
    createUserWithEmailAndPassword,
    sendEmailVerification
  } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
  import {
    doc,
    setDoc,
    serverTimestamp
  } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const form = document.getElementById("form");
  const errorEl = document.getElementById("error");

  const usernameInput = document.getElementById("username");
  const passwordInput = document.getElementById("password");
  const confirmInput = document.getElementById("confirmPassword");
  const showPassword = document.getElementById("showPassword");

  const strengthFill = document.getElementById("strengthFill");
  const strengthText = document.getElementById("strengthText");

  /* ðŸ”¤ Username rules */
  usernameInput.addEventListener("input", (e) => {
    e.target.value = e.target.value
      .toLowerCase()
      .replace(/\s/g, "")
      .replace(/[^a-z0-9._]/g, "");
  });

  /* ðŸ‘ Show / Hide Password */
  showPassword.addEventListener("change", () => {
    const type = showPassword.checked ? "text" : "password";
    passwordInput.type = type;
    confirmInput.type = type;
  });

  /* ðŸ” Password strength meter */
  passwordInput.addEventListener("input", () => {
    const val = passwordInput.value;
    let score = 0;

    if (val.length >= 8) score++;
    if (/[a-z]/.test(val)) score++;
    if (/\d/.test(val)) score++;
    if (/[@$!%*#?&]/.test(val)) score++;

    const levels = [
      { width: "25%", color: "#dc2626", text: "Too weak" },
      { width: "50%", color: "#ea580c", text: "Weak" },
      { width: "75%", color: "#ca8a04", text: "Good" },
      { width: "100%", color: "#16a34a", text: "Strong" }
    ];

    const level = levels[Math.min(score, 3)];
    strengthFill.style.width = level.width;
    strengthFill.style.background = level.color;
    strengthText.textContent = level.text;
  });

  /* ðŸš€ Signup */
  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const email = document.getElementById("email").value.trim();
    const username = usernameInput.value.trim();
    const password = passwordInput.value;
    const confirm = confirmInput.value;

    const usernameRegex = /^[a-z0-9._]+$/;
    if (!usernameRegex.test(username)) {
      errorEl.textContent =
        "Username may contain only lowercase letters, numbers, dots, and underscores.";
      return;
    }

    if (password !== confirm) {
      errorEl.textContent = "Passwords do not match.";
      return;
    }

    if (password.length < 8) {
      errorEl.textContent = "Password must be at least 8 characters.";
      return;
    }

    try {
      const cred = await createUserWithEmailAndPassword(auth, email, password);

      await setDoc(doc(db, "users", cred.user.uid), {
        username,
        email,
        createdAt: serverTimestamp()
      });

      await sendEmailVerification(cred.user);

      alert(
  "Account created successfully!\n\n" +
  "A verification email has been sent.\n" +
  "ðŸ‘‰ Please check your INBOX.\n" +
  "ðŸ‘‰ If you donâ€™t see it, CHECK YOUR SPAM folder and mark it as 'Not Spam'."
);

    } catch (error) {
      errorEl.textContent = error.message;
    }
  });
</script>
 <script src="particles.js"></script> 
</body>
</html>
